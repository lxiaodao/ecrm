<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:tx="http://www.springframework.org/schema/tx" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:cache="http://www.springframework.org/schema/cache" xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mongo="http://www.springframework.org/schema/data/mongo"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
           http://www.springframework.org/schema/tx
           http://www.springframework.org/schema/tx/spring-tx-2.5.xsd
           http://www.springframework.org/schema/aop
           http://www.springframework.org/schema/aop/spring-aop-2.5.xsd
           http://www.springframework.org/schema/context
           http://www.springframework.org/schema/context/spring-context-3.0.xsd          
           http://www.springframework.org/schema/cache
           http://www.springframework.org/schema/cache/spring-cache.xsd           
           http://www.springframework.org/schema/data/mongo
           http://www.springframework.org/schema/data/mongo/spring-mongo.xsd
           http://www.springframework.org/schema/jee http://www.springframework.org/schema/jee/spring-jee-2.0.xsd"
	default-lazy-init="false">


	
    <description>Spring公共配置文件 </description>
	
	<!-- 使用annotation 自动注册bean,并保证@Required,@Autowired的属性被注入 -->
	
    <context:component-scan base-package="com.weheros,cn.crazychain" />



     <bean id="ds1" class="com.mysql.jdbc.jdbc2.optional.MysqlXADataSource">
<!-- 			    <property name="driverClass" value="com.mysql.jdbc.Driver" /> -->
				<property name="url" value="jdbc:mysql://localhost:3306/crazychain_db?autoReconnect=true" />
				<property name="user" value="root" />
				<property name="password" value="123456" />
			</bean>

	<!-- 数据源配置,主要用于开发测试环境 -->
	<bean id="dataSourceA" class="com.atomikos.jdbc.AtomikosDataSourceBean"  init-method="init" destroy-method="close">
		
		<property name="xaDataSource" ref="ds1" />
		
		<property name="uniqueResourceName"><value>XADS1</value></property> 
		 <property name="poolSize"><value>20</value></property>
	</bean>
	
<!-- 	<bean id="dataSourceA" class="com.atomikos.jdbc.AtomikosDataSourceBean"  init-method="init" destroy-method="close">
    <qualifier value="jmsRecoveryDatabaseSchema"/> 
    <property name="uniqueResourceName"><value>XADS1</value></property> 
    <property name="xaDataSourceClassName"> 
        <value>oracle.jdbc.xa.client.OracleXADataSource</value> 
    </property> 
    <property name="xaProperties"> 
        <props> 
            <prop key="URL">${jdbc.url}</prop> 
            <prop key="user">${jdbc.username}</prop> 
           <prop key="password">${jdbc.password}</prop> 
        </props> 
    </property> 
    <property name="poolSize"><value>1</value></property>
    <property name="testQuery" value="SELECT 1 FROM DUAL"/>
</bean> -->

			<bean id="ds2" class="com.mysql.jdbc.jdbc2.optional.MysqlXADataSource">
<!-- 			    <property name="driverClass" value="com.mysql.jdbc.Driver" /> -->
				<property name="url" value="jdbc:mysql://192.168.10.12:3306/article_db?autoReconnect=true" />
				<property name="user" value="root" />
				<property name="password" value="MyNewPass4!" />
			</bean>
	
	<bean id="dataSource2" class="com.atomikos.jdbc.AtomikosDataSourceBean"  init-method="init" destroy-method="close">
		
		<property name="xaDataSource" ref="ds2" />

				
		<property name="uniqueResourceName"><value>articleunit</value></property> 
		 <property name="poolSize"><value>20</value></property>
	</bean>
	
	<bean id="onejdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
	   <constructor-arg name="dataSource" ref="dataSourceA" />
	   
	</bean>
	
	
	<bean id="twojdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
	   <constructor-arg name="dataSource" ref="dataSource2" />
	   
	</bean>
	
	
	
	<bean id="transactionManager"
		class="org.springframework.transaction.jta.JtaTransactionManager">
		<property name="transactionManager">
			<bean class="com.atomikos.icatch.jta.UserTransactionManager"
				init-method="init" destroy-method="close">
				<property name="forceShutdown">
					<value>true</value>
				</property>
				<property name="transactionTimeout">
					<value>600</value>
				</property>
			</bean>
		</property>
		<property name="userTransaction">
			<bean class="com.atomikos.icatch.jta.UserTransactionImp" />
		</property>
	</bean>

	
	<!-- 使用annotation定义事务 -->
	<tx:annotation-driven transaction-manager="transactionManager"  />
	


	
	
</beans>